<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://dmenezesgabriel.github.io//assets/img/chamaleon.png">
    <title>Making a Database Handler pt.1 - Docker - Gabriel Menezes</title>
    <link rel="stylesheet" href="https://dmenezesgabriel.github.io//assets/css/main.css">
    <link rel="stylesheet" href="https://dmenezesgabriel.github.io//assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://dmenezesgabriel.github.io//assets/css/dracula.css">
    <script src="https://dmenezesgabriel.github.io//assets/js/all.min.js"></script>
    <script src="https://dmenezesgabriel.github.io//assets/js/jquery-3.5.1.slim.min.js"></script>
    <script src="https://dmenezesgabriel.github.io//assets/js/bootstrap.min.js"></script>
    <script src="https://dmenezesgabriel.github.io//assets/js/barToggle.js"></script>
    <script src="https://dmenezesgabriel.github.io//assets/js/searchBar.js"></script>
    <!-- Only ping google when on production environment -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-169523526-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-169523526-1');
</script>
    
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Making a Database Handler pt.1 - Docker | Gabriel Menezes</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Making a Database Handler pt.1 - Docker" />
<meta name="author" content="Gabriel Menezes" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Making a Database Handler pt.1 - Docker" />
<meta property="og:description" content="Making a Database Handler pt.1 - Docker" />
<link rel="canonical" href="https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html" />
<meta property="og:url" content="https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html" />
<meta property="og:site_name" content="Gabriel Menezes" />
<meta property="og:image" content="https://dmenezesgabriel.github.io//assets/img/posts/2020-06-10-database-handler-1/cover.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-11T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://dmenezesgabriel.github.io//assets/img/posts/2020-06-10-database-handler-1/cover.jpg" />
<meta property="twitter:title" content="Making a Database Handler pt.1 - Docker" />
<meta name="twitter:site" content="@dmenezesgabriel" />
<meta name="twitter:creator" content="@Gabriel Menezes" />
<script type="application/ld+json">
{"datePublished":"2020-06-11T00:00:00+00:00","description":"Making a Database Handler pt.1 - Docker","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html"},"author":{"@type":"Person","name":"Gabriel Menezes"},"url":"https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html","image":"https://dmenezesgabriel.github.io//assets/img/posts/2020-06-10-database-handler-1/cover.jpg","headline":"Making a Database Handler pt.1 - Docker","dateModified":"2020-06-17T21:50:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>

    <div class="container-fluid fill-height">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-md-block sidebar bg-success" id="sidebar">
    <div class="sidebar-header mt-3 mb-3 text-center">
        <div class="close-btn">
            <div class="row">
                <div class="col-sm">
                    <button id="dismiss" onclick="closeNav()" class="btn close" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
            </div>
        </div>
        <h3>
            <a class="blog-name h5" href="/">Gabriel Menezes</a>
        </h3>
    </div>
    <div class="profile-section components text-center">
        <img class="profile-image mb-3" src="https://dmenezesgabriel.github.io//assets/img/profile-picture.png" alt="My image">
        <div class="bio text-center">
            <p>
                Bug developer and my father's son. Night gathers, and now my coding begins. It shall not end until I understand what I wrote at last week.
            </p>
        </div>
            <ul class="list-unstyled components text-center">

                <div class="social-list">
                    
                        <li class="list-inline-item">
                            <a href="https://github.com/dmenezesgabriel" class="list-inline py-1 mx-auto icon" target="_blank">
                                <i class="fab fa-github"></i>
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            <a href="https://twitter.com/dmenezesgabriel" class="list-inline py-1 mx-auto icon" target="_blank">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </li>
                    
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/in/dmenezesgabriel/" class="list-inline py-1 mx-auto icon" target="_blank">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        </li>
                    
                </div>
                <hr>
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/portfolio/">Portfolio</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/contact/">Contact</a>
                </li>
            </ul>
        </div>
</nav>

            <!-- Content -->
            <div class="col-sm pt-3 px-4" id="main">
            <nav class="navbar rounded navbar-expand-lg flex">
  <form class="form-inline">
    <div class="input-group">
      <button type="button" id="sidebarCollapse" onclick="toggleNav()" class="btn">
          <span></span>
          <span></span>
          <span></span>
      </button>
      <input id="search" class="form-control mr-sm-2 ml-3 w-75" type="text" placeholder="Search">
    </div>
    </form>
  </nav>
  <div id="search-result" class="card p-3"></div>
            <div id="welcome" class="container bg-white rounded">
    <div class="text-center">
        <hr>
        <h4 class="text-dark">Welcome to Gabriel's Blog</h4>
        <hr>
    </div>
</div>
            <div id="carouselIndicators" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
			
				
					<li data-target="#carouselIndicators" data-slide-to="0" class="active">
				
			
				
					<li data-target="#carouselIndicators" data-slide-to="1">
				
			
				
					<li data-target="#carouselIndicators" data-slide-to="2">
				
			
		</ol>

    <div class="carousel-inner rounded mb-3">
			
				
					<div class="carousel-item active">
						<div class="carousel-img">
							<img class="d-block w-100" src="https://dmenezesgabriel.github.io//assets/img/posts/2020-06-16-database-handler-2/cover.jpg" alt="slide">
						</div>
						<div class="carousel-caption">
							<h5>Making a Database Handler pt.2 - Pipenv</h5>
							<p>If you already not, you should check my previou...</p>
							<a href="/python/2020/06/17/database-handler-2.html" class="btn-sm btn-success">Read</a>
						</div>
					</div>
				
			
				
					<div class="carousel-item">
						<div class="carousel-img">
							<img class="d-block w-100" src="https://dmenezesgabriel.github.io//assets/img/posts/2020-06-18-database-handler-3/cover.png" alt="slide">
						</div>
						<div class="carousel-caption">
							<h5>Making a Database Handler pt.3 - Psycopg</h5>
							<p>Psycopg is a very popular database driver for P...</p>
							<a href="/python/2020/06/18/database-handler-3.html" class="btn-sm btn-success">Read</a>
						</div>
					</div>
				
			
				
					<div class="carousel-item">
						<div class="carousel-img">
							<img class="d-block w-100" src="https://dmenezesgabriel.github.io//assets/img/posts/2020-06-24-database-handler-4/cover.jpg" alt="slide">
						</div>
						<div class="carousel-caption">
							<h5>Making a Database Handler pt.4 - GitHub</h5>
							<p>In this tutorial, I'll show you how to add an e...</p>
							<a href="/github/2020/06/24/database-handler-4.html" class="btn-sm btn-success">Read</a>
						</div>
					</div>
				
			
		</div>

    <a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
</div>
            <hr>

            <!-- Content Goes here -->
            <div class="container">
  <div class="row">
    <div class="col-md-12 card mb-4  mt-3 left  top">
      <div class="card-body">
        <h1>Making a Database Handler pt.1 - Docker</h1>
        <p class="text-muted">Gabriel Menezes | Thu, Jun 11, 20</p>
        <p class="text-muted"> Last update: Wed, Jun 17, 20</p>
        <img style="width: inherit;" src="http://hits.dwyl.com/dmenezesgabriel.github.io/docker/2020/06/11/database-handler-1.html.svg" alt="hit count image">
        <hr>
        <p class="card-text "></p>
<p>A database handler offers a way to interface with databases of different kinds using code languages as Javascript and Python, so it’s possible to bring an query result and manipulate as python dict objects on your ETL script, jupyter notebook analysis and many others.</p>

<p>For this tutorial we will build a custom, but yet simple image of PostgreSQL relacional database from where we will collect information with our python based database handler.</p>

<p><strong>Ingredients</strong>:</p>
<ul>
  <li>PostgreSQL</li>
  <li>Docker</li>
  <li>Python</li>
  <li>Pipenv</li>
</ul>

<h2 id="database-transaction">Database Transaction</h2>

<p>A database transaction is a unit of work that is performed against a database and it may contain several smaller tasks in it, It also has to either happen in full or not at all, that is the ACID principle of <strong>Atomicity</strong>.</p>

<p>That is a transaction is a propagation of one or more changes to the database as creating records, updating or deleting it from a table.</p>

<h2 id="cursors">Cursors</h2>

<p>The cursor holds the control of the position in a set of results and allow you to perform several operations row by row in a dataset returning or not to the original table, it points to an specific line inside a set being able to perform operations such as update, delete or move data.</p>

<h2 id="psycopg">Psycopg</h2>

<p>In psycopg, the connection class handle the transactions and when you perform the first statement to the PostgreSQL database using a cursor object, psycopg creates a new transaction in which all subsequent statements will be contained, in case of any of the statements comes to fail, psycopg will abort the transaction and no register will be altered.</p>

<h2 id="docker">Docker</h2>

<p>Docker is a softwere which offers container units that package up all your code and it’s dependencies, so it’s possible to create the same environment from one computer to another without massive headaches.</p>

<h2 id="hands-on">Hands-on</h2>

<p>So let’s read the recipe and bake this <strong>cake</strong>!</p>

<h3 id="creating-folders">Creating folders</h3>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh"><span class="nb">mkdir </span>python-database-handler <span class="o">&amp;&amp;</span><span class="se">\</span>
<span class="nb">cd </span>python-database-handler <span class="o">&amp;&amp;</span><span class="se">\</span>
<span class="nb">touch </span>database_handler.py <span class="o">&amp;&amp;</span><span class="se">\</span>
<span class="nb">touch </span>Dockerfile <span class="o">&amp;&amp;</span><span class="se">\</span>
<span class="nb">touch </span>Makefile <span class="o">&amp;&amp;</span> <span class="se">\</span>
<span class="nb">touch </span>init.sql</code></pre></figure>

<h3 id="getting-the-flour">Getting the flour</h3>

<p>I really enjoy to use <a href="https://code.visualstudio.com/">vscode</a> as text editor, but you can use vim, nano or notepad ++ if you want and then hunt dinossaurs for diner and bring to the cave, light the fire… you know!(acting as 21st century hipster).</p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">code Dockerfile</code></pre></figure>

<h3 id="breaking-somme-eggs">Breaking somme eggs</h3>

<p>Here we create our own postgres Docker image through a <code class="language-html highlighter-rouge">Dockerfile</code></p>

<figure class="highlight"><pre><code class="language-dockerfile" data-lang="dockerfile"><span class="c"># Pull official PostgreSQL image from dockerhub https://hub.docker.com/</span>
<span class="k">FROM</span><span class="s"> postgres</span>
<span class="c"># Set environment variables</span>
<span class="k">ENV</span><span class="s"> POSTGRES_PASSWORD postgres</span>
<span class="k">ENV</span><span class="s"> POSTGRES_DB postgres</span>
<span class="c"># By defaults every script located at /docker-entrypoint-initdb.d/</span>
<span class="c"># will be automatically executed during container startup</span>
<span class="k">COPY</span><span class="s"> init.sql /docker-entrypoint-initdb.d/</span></code></pre></figure>

<p>last but not least we create the ini.sql file which will make the transactions as creating and inserting data in tables.</p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">code init.sql</code></pre></figure>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">public</span><span class="p">.</span><span class="n">authors</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span></code></pre></figure>

<h3 id="mix-everything-up">Mix everything up</h3>

<p>And then automagically build our image</p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">docker build <span class="nt">-t</span> custom-image .</code></pre></figure>

<ul>
  <li>
<code class="language-html highlighter-rouge">build</code>: Command that builds Docker images from a Dockerfile and a “context”.</li>
  <li>
<code class="language-html highlighter-rouge">--tag , -t</code>: Name and optionally a tag in the ‘name:tag’ format.</li>
</ul>

<p>Check for builded images</p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">docker images <span class="nt">-a</span></code></pre></figure>

<ul>
  <li>
<code class="language-html highlighter-rouge">images</code>: This command will show all top level images, their repository and tags, and their size.</li>
  <li>
<code class="language-html highlighter-rouge">--all , -a</code>: Show all images (default hides intermediate images).</li>
</ul>

<h3 id="baking-the-cake">Baking the cake</h3>

<p>Running it as a container</p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">docker run <span class="nt">-d</span> <span class="nt">--name</span> custom-image-container <span class="nt">-p</span> 5555:5432 custom-image</code></pre></figure>

<ul>
  <li>
<code class="language-html highlighter-rouge">run</code>: First it creates a container over the specified image, and then starts it.</li>
  <li>
<code class="language-html highlighter-rouge">--detach , -d</code>: 	Run container in background and print container ID.</li>
  <li>
<code class="language-html highlighter-rouge">--name</code>: Assign a name to the container.</li>
  <li>
<code class="language-html highlighter-rouge">-p</code>: Bounds the container to the specified port.</li>
</ul>

<h3 id="open-the-oven-and-smell-it">Open the oven and smell it</h3>

<p>Execute bash inside the container itself</p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">docker <span class="nb">exec</span> <span class="nt">-i</span> <span class="nt">-t</span> custom-image-container /bin/bash</code></pre></figure>

<ul>
  <li>
<code class="language-html highlighter-rouge">exec</code>: Runs a new command in a running container.</li>
  <li>
<code class="language-html highlighter-rouge">--interactive , -i</code>: Keep STDIN open even if not attached.</li>
  <li>
<code class="language-html highlighter-rouge">--tty , -t</code>: Allocate a pseudo-TTY.</li>
</ul>

<p>Connect to the database via <code class="language-html highlighter-rouge">psql</code></p>

<figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">psql <span class="nt">-h</span> localhost <span class="nt">-U</span> postgres <span class="nt">-d</span> postgres</code></pre></figure>

<ul>
  <li>
<code class="language-html highlighter-rouge">-h</code>: host.</li>
  <li>
<code class="language-html highlighter-rouge">-U</code>: User name.</li>
  <li>
<code class="language-html highlighter-rouge">-d</code>: Database name.</li>
</ul>

<h3 id="the-cherry-on-the-cake">The cherry on the cake</h3>

<p>Insert some data into the table <code class="language-html highlighter-rouge">public.authors</code></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">public</span><span class="p">.</span><span class="n">authors</span>
    <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="k">VALUES</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'J. k. Rowling'</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Stephen King'</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Timothy Ferris'</span><span class="p">);</span></code></pre></figure>

<p><strong>Query</strong>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">public</span><span class="p">.</span><span class="n">authors</span><span class="p">;</span></code></pre></figure>

<p><strong>Output</strong>:</p>

<table class="table table-dark">
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>J. k. Rowling</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Stephen King</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Timothy Ferris</td>
    </tr>
  </tbody>
</table>

<p><br></p>

<p>On the next episode we will spice the things a litte with Pipenv, a nice pretty little package manager! <img class="emoji" title=":+1:" alt=":+1:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20"></p>

<p><a href="https://dmenezesgabriel.github.io/python/2020/06/17/database-handler-2.html">Making a Database Handler pt.2 - Docker</a></p>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://www.postgresqltutorial.com/">Postgres Tutorials</a></li>
  <li><a href="https://docs.docker.com/">Docker’s documentation</a></li>
  <li><a href="https://www.psycopg.org/docs/">Psycopg’s documentation</a></li>
  <li><a href="https://medium.com/@wkrzywiec/database-in-a-docker-container-how-to-start-and-whats-it-about-5e3ceea77e50">Wkrzywiec’s medium</a></li>
</ul>

      </div>
    </div>
  </div>
  <div class="text-center">
  <div class="title">
    <h6 class="font-weight-bold text-dark">Share this</h6>
    <hr class="w-25">
  </div>
  <div class="social-icons">
      <a href="https://twitter.com/intent/tweet?via=dmenezesgabriel&amp;url=https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html&amp;text=Making%20a%20Database%20Handler%20pt.1%20-%20Docker" target="_blank">
        <i class="fab fa-twitter-square fa-2x"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html&amp;title=Making%20a%20Database%20Handler%20pt.1%20-%20Docker" target="_blank">
        <i class="fab fa-linkedin fa-2x"></i>
      </a>
  </div>
</div>
  <hr>
  
    <div id="disqus_thread"></div>
    <script>
    var disqus_config = function () {
    this.page.url = 'https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html';  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = 'https://dmenezesgabriel.github.io//docker/2020/06/11/database-handler-1.html'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://dmenezesgabriel.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
  
</div>

        </div>
    </div>
</div></body>
</html>